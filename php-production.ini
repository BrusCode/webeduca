; ========================================
; PHP.INI Otimizado para Academy LMS
; AMBIENTE DE PRODUÇÃO
; Suporte para vídeos até 2GB
; ========================================

; -----------------------------------------
; CONFIGURAÇÕES DE UPLOAD (2GB)
; -----------------------------------------
; Tamanho máximo de arquivo para upload (2GB)
upload_max_filesize = 2048M

; Tamanho máximo de dados POST (deve ser >= upload_max_filesize)
; Adicional de 100MB para metadados do formulário
post_max_size = 2148M

; Número máximo de arquivos que podem ser enviados simultaneamente
max_file_uploads = 20

; -----------------------------------------
; CONFIGURAÇÕES DE EXECUÇÃO
; -----------------------------------------
; Tempo máximo de execução de um script (30 minutos para uploads grandes)
max_execution_time = 1800

; Tempo máximo para processar dados de input (30 minutos)
max_input_time = 1800

; Tempo máximo de input para variáveis
max_input_vars = 5000

; -----------------------------------------
; CONFIGURAÇÕES DE MEMÓRIA
; -----------------------------------------
; Limite de memória para scripts PHP (512MB para processar vídeos)
memory_limit = 512M

; -----------------------------------------
; CONFIGURAÇÕES DE SESSÃO
; -----------------------------------------
; Tempo de vida da sessão (24 horas = 86400 segundos)
session.gc_maxlifetime = 86400

; Probabilidade de limpeza de sessões antigas
session.gc_probability = 1
session.gc_divisor = 1000

; Nome da sessão (personalizado para segurança)
session.name = ACADEMY_SESSID

; -----------------------------------------
; CONFIGURAÇÕES DE ERRO E LOG (PRODUÇÃO)
; -----------------------------------------
; NÃO exibir erros em produção (segurança)
display_errors = Off
display_startup_errors = Off

; Registrar erros em log
log_errors = On

; Nível de relatório de erros (sem deprecated e strict)
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT & ~E_NOTICE

; Tamanho máximo do log de erros (10MB)
log_errors_max_len = 10240

; -----------------------------------------
; CONFIGURAÇÕES DE PERFORMANCE (OPCACHE)
; OTIMIZADO PARA PRODUÇÃO
; -----------------------------------------
; Habilitar OPcache
opcache.enable = 1

; Desabilitar OPcache para CLI
opcache.enable_cli = 0

; Memória alocada para OPcache (256MB para aplicações grandes)
opcache.memory_consumption = 256

; Memória para strings internalizadas (16MB)
opcache.interned_strings_buffer = 16

; Número máximo de arquivos em cache (Academy LMS tem muitos arquivos)
opcache.max_accelerated_files = 20000

; Frequência de revalidação de timestamps (60 segundos em produção)
; Arquivos só são verificados a cada 60 segundos
opcache.revalidate_freq = 60

; DESABILITAR validação de timestamps em produção (máxima performance)
; Arquivos nunca são verificados, apenas após restart do PHP-FPM
opcache.validate_timestamps = 0

; Salvar comentários (necessário para Doctrine, annotations, etc)
opcache.save_comments = 1

; Habilitar otimizações de arquivo
opcache.file_cache_only = 0
opcache.file_update_protection = 2

; Otimizações adicionais
opcache.fast_shutdown = 1
opcache.enable_file_override = 1

; -----------------------------------------
; CONFIGURAÇÕES DE SEGURANÇA (PRODUÇÃO)
; -----------------------------------------
; Desabilitar funções perigosas
disable_functions = exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source

; NÃO expor versão do PHP (segurança)
expose_php = Off

; Permitir apenas cookies HTTP (proteção XSS)
session.cookie_httponly = 1

; Usar cookies seguros APENAS em HTTPS (produção)
session.cookie_secure = 1

; SameSite cookie policy (proteção CSRF)
session.cookie_samesite = Strict

; Usar apenas cookies para sessão (não URL)
session.use_only_cookies = 1
session.use_trans_sid = 0

; Regenerar ID de sessão periodicamente
session.sid_length = 48
session.sid_bits_per_character = 6

; -----------------------------------------
; CONFIGURAÇÕES DE TIMEZONE
; -----------------------------------------
; Definir timezone padrão (ajuste conforme sua localização)
date.timezone = America/Sao_Paulo

; -----------------------------------------
; CONFIGURAÇÕES DE OUTPUT
; -----------------------------------------
; Buffer de saída (útil para performance)
output_buffering = 4096

; Compressão de saída (economiza banda - ATIVAR EM PRODUÇÃO)
zlib.output_compression = On
zlib.output_compression_level = 6

; -----------------------------------------
; CONFIGURAÇÕES DE REALPATH CACHE
; -----------------------------------------
; Cache de caminhos reais (melhora I/O significativamente)
realpath_cache_size = 8192K
realpath_cache_ttl = 7200

; -----------------------------------------
; CONFIGURAÇÕES ADICIONAIS DE PERFORMANCE
; -----------------------------------------
; Desabilitar registro de argumentos em backtrace (performance)
zend.exception_ignore_args = On

; Assertions desabilitadas em produção
assert.active = 0

; -----------------------------------------
; CONFIGURAÇÕES DE CHARSET
; -----------------------------------------
; Charset padrão
default_charset = "UTF-8"

; -----------------------------------------
; CONFIGURAÇÕES DE MAIL
; -----------------------------------------
; Configurar sendmail path (se usar mail() do PHP)
; sendmail_path = /usr/sbin/sendmail -t -i

; -----------------------------------------
; CONFIGURAÇÕES MYSQLI (ACADEMY LMS)
; -----------------------------------------
; Permitir reconexão automática
mysqli.reconnect = On

; Timeout de conexão
mysqli.connect_timeout = 60

; -----------------------------------------
; CONFIGURAÇÕES DE FILEINFO
; -----------------------------------------
; Habilitar detecção de MIME type
file_uploads = On

